// Generated by CoffeeScript 1.4.0
(function() {
  var ExplosionSpriteData, ExplosionSpriteSheet;

  ExplosionSpriteData = {
    framerate: 15,
    images: ["/images/explosion.png"],
    frames: {
      width: 128,
      height: 128
    },
    animations: {
      explode: {
        frames: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
      }
    }
  };

  ExplosionSpriteSheet = new createjs.SpriteSheet(ExplosionSpriteData);

  this.Tile = (function() {

    Tile.EXPLODE_FRAMES = 11;

    function Tile(position, item) {
      this.position = position;
      this.item = item != null ? item : null;
      true;
    }

    Tile.prototype.bomb = null;

    Tile.prototype.players = [];

    Tile.prototype.color = "yellow";

    Tile.prototype.check_if_solid = function() {
      return this.bomb;
    };

    Tile.prototype.onStep = function(stage, field, player) {
      if (this.item) {
        this.item.onStep(stage, field, player);
      }
      if (this.bomb) {
        return this.bomb.onStep(stage, field, player);
      }
    };

    Tile.prototype.onFire = function(stage, field) {
      var player, tile, _i, _len, _ref;
      if (this.item) {
        this.item.onFire(stage, field);
      }
      if (this.bomb) {
        this.bomb.onFire(stage, field);
      }
      if (this.players.length > 0) {
        _ref = this.players;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          player = _ref[_i];
          player.onFire(stage, field);
        }
      }
      if (!this.fire_gfx) {
        this.fire_gfx = new createjs.Sprite(ExplosionSpriteSheet, "explode");
        this.fire_gfx.scaleX = 0.5;
        this.fire_gfx.scaleY = 0.5;
        this.fire_gfx.y = this.position[0] * window.UNIT;
        this.fire_gfx.x = (this.position[1] * window.UNIT) + PADDING;
        stage.addChild(this.fire_gfx);
      }
      this.draw(stage);
      this.fire_gfx.gotoAndPlay("explode");
      stage.update();
      tile = this;
      return window.tick_events.push({
        count: window.Tile.EXPLODE_FRAMES,
        method: function() {
          return true;
        },
        finish: function() {
          stage.removeChild(tile.fire_gfx);
          return tile.fire_gfx = null;
        }
      });
    };

    Tile.prototype.draw = function(stage, ignore_cache) {
      var player, _i, _len, _ref, _results;
      if (ignore_cache == null) {
        ignore_cache = false;
      }
      if (!this.gfx || ignore_cache) {
        this.gfx = new createjs.Shape();
        this.gfx.graphics.beginFill(this.color).drawRect(0, 0, UNIT, UNIT);
        this.gfx.y = this.position[0] * UNIT;
        this.gfx.x = (this.position[1] * UNIT) + PADDING;
        stage.addChild(this.gfx);
      }
      if (this.item) {
        this.item.draw(stage);
      }
      if (this.bomb) {
        this.bomb.draw(stage);
      }
      if (this.players.length > 0) {
        _ref = this.players;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          player = _ref[_i];
          _results.push(player.draw(stage));
        }
        return _results;
      }
    };

    return Tile;

  })();

}).call(this);

// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var DIMENSIONS, FPS, game_canvas, player_id, player_ids;
    game_canvas = $("#game_window");
    DIMENSIONS = [1200, 600];
    window.PADDING = DIMENSIONS[0] / 4;
    window.UNIT = DIMENSIONS[1] / 9;
    FPS = 30;
    window.socket = io("http://localhost:8009");
    player_id = null;
    player_ids = [];
    socket.on("handshake", function(new_player_id) {
      return player_id = new_player_id;
    });
    return socket.on("game_start", function(game_id, new_player_ids) {
      var handleTick, my_player, my_start, that_player, your_start;
      player_ids = new_player_ids;
      window.field = FieldBuilder.build_new_field("advanced");
      window.stage = new createjs.Stage("game_window");
      window.stage.canvas.width = DIMENSIONS[0];
      window.stage.canvas.height = DIMENSIONS[1];
      if (player_id === player_ids[0]) {
        my_start = [1, 1];
        your_start = [7, 7];
      } else {
        my_start = [7, 7];
        your_start = [1, 1];
      }
      my_player = new Player(my_start, player_id, true);
      that_player = new Player(your_start, false, false);
      window.FieldBuilder.draw_field(field, window.stage);
      window.tick_events = [];
      handleTick = function() {
        var event, index, new_tick_events, _i, _len, _ref;
        new_tick_events = [];
        _ref = window.tick_events;
        for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {
          event = _ref[index];
          event.count--;
          event.method();
          if (event.count < 1) {
            event.finish();
            window.tick_events[index] = null;
          }
        }
        window.tick_events = window.tick_events.filter(function(event) {
          return event;
        });
        my_player.draw(window.stage);
        that_player.draw(window.stage);
        return stage.update();
      };
      createjs.Ticker.setFPS(FPS);
      createjs.Ticker.addEventListener("tick", handleTick);
      return stage.update();
    });
  });

}).call(this);
